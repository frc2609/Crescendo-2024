# Control Algorithms
* Setpoint = where you'd like the mechanism to be. Typically a specific velocity (e.g. RPM) or position (e.g. angle).
* To learn how to tune these controllers, see [WPILib's interactive tutorials](https://docs.wpilib.org/en/stable/docs/software/advanced-controls/introduction/tutorial-intro.html).

## Bang-Bang Controller
* Can be described as:
    * If currentVelocity \< desiredVelocity, run motor.
    * Otherwise, do nothing.
* Works well for high-inertia mechanisms (e.g. flywheels) and requires no tuning.

## Feedforward (FF)
* Used to counteract predictable forces (e.g. gravity or friction)
* For the shooter or elevator, feedforward counteracts gravity and holds the mechanism in the current position. With only FF, the mechanism shouldn't move.
* For the Krakens on swerve drive, feedforward applies enough motor power to overcome friction.
* When controlling the shooter arm or elevator, use FF with a PID.

## PID
* Used to approach setpoint.
* Can be used alone, or with FF as well (more effective).

## Profiled PID
* [WPILib Docs](https://docs.wpilib.org/en/stable/docs/software/advanced-controls/controllers/profiled-pidcontroller.html)
* Profiled PID controllers generate a list of setpoints between the current position and "goal" position (called a "motion profile") and then use a PID controller to make the mechanism move to each setpoint. Once a setpoint is reached, the controller moves onto the next setpoint, continuing until the goal is reached.
* Several advantages over using a plain PID + FF:
    * Generates a smooth set of waypoints (so mechanism doesn't slam into hardstop or overshoot target)
    * Configurable limits on max velocity and acceleration
    * Setpoints are close together, so error is small and remains consistent, making it significantly easier to tune the PID controller.
        * Since the error is consistent, you can have aggressive PID gains without worrying that the mechanism will overshoot.
* Have a "goal" position (the position you want the mechanism to be at) and a "setpoint" (the position the PID controller is trying to get to).
* If your mechanism position has deviated from the motion profile (i.e. error is too high), you should replan the motion profile.
    * Otherwise, the PID + FF that is tuned to follow small errors is going to set your motors much higher than you'd like.

### Tuning:
* There are two things to tune: The velocity and acceleration constraints, and the PID controller. (Also, a seperate FF controller if you are using one.)
* Velocity and acceleration constants:
    * Tune these to make the mechanism reach the desired position faster or slower.
    * These will affect how steep the motion profile is.
* PID Controller
    * Tune the PID controller to make the mechanism reach *the setpoints output by the profiled PID controller*.
    * Make sure to compare the mechanism position to the setpoints output by the profiled PID controller when tuning the PID, *not* to the goal position.
        * i.e. `Shooter/Angle/Motion Profile Setpoint (Deg)`, not `Shooter/Angle/Target Angle (Deg)`
* If your mechanism is taking too long to reach the goal position, adjust the velocity and acceleration constraints, not the PID gains. PID gains should be adjusted if the mechanism isn't tracking the setpoints generated by the profiled PID control.

### Proper Usage
* You must reset the profiled PID controller if it stops being called at any point (e.g. when the robot is disabled).
    * This is because when you call the profiled PID controller again, it will assume the mechanism is in the same place as it was when you stopped calling the profiled PID controller. If your mechanism moved while the profiled PID controller was disabled, the built in PID will try to go from the mechanism's current position to the motion profile's setpoint (which could be very far away) and the mechanism will likely overshoot and break something.

# Notes on Mechanisms

## Shooter Angle
* A profiled PID controller is much more accurate than a plain PID on the arm.
    * It's way easier to tune, and smoother.
* With a plain PID controller, 'D' works incredibly poorly (causes jitter and oscillation, even when really small), so it's not a good idea to use it.

## Shooter Flywheel
* Tune feedforward first to get RPM close to setpoint (e.g. within 100 RPM)
* Then use PID to get RPM within desired tolerance (e.g. within 25 RPM)